<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à | SWG. SHOP</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { font-family: 'Kanit', sans-serif; padding: 30px; background:#f7f7f7; }
        .receipt { max-width:800px; margin:0 auto; background:#fff; padding:24px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
        h1 { font-size:1.4rem; margin-bottom:12px; }
        .meta { margin-bottom:18px; color:#555; }
        .items { border-top:1px solid #eee; margin-top:12px; padding-top:12px; }
        .item-row { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px dashed #eee; }
        .total { display:flex; justify-content:space-between; font-weight:700; font-size:1.1rem; margin-top:12px; }
        .actions { margin-top:18px; display:flex; gap:10px; }
        .btn { padding:10px 14px; border-radius:6px; border:none; cursor:pointer; }
        .btn-print { background:#ff4b2b; color:#fff; }
        .btn-home { background:#eee; }
        .empty { text-align:center; padding:40px 10px; color:#777; }
    </style>
</head>
<body>
    <div class="receipt">
        <h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>
        <div id="receipt-content">
            <div class="meta" id="order-meta"></div>
            <div class="items" id="order-items"></div>
            <div class="total" id="order-total"></div>
            <div class="actions">
                <button class="btn btn-print" id="print-btn">‡∏û‡∏¥‡∏°‡∏û‡πå/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</button>
                <button class="btn btn-home" id="home-btn">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
            </div>
        </div>
        <div id="no-order" class="empty" style="display:none;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
    </div>

    <script>
        function formatCurrency(n){ return '‡∏ø' + Number(n).toLocaleString(); }

        document.addEventListener('DOMContentLoaded', ()=>{
            const raw = localStorage.getItem('lastOrder');
            if(!raw){
                document.getElementById('receipt-content').style.display='none';
                document.getElementById('no-order').style.display='block';
                return;
            }

            let order;
            try{ order = JSON.parse(raw); }catch(e){
                document.getElementById('receipt-content').style.display='none';
                document.getElementById('no-order').style.display='block';
                return;
            }

            const metaEl = document.getElementById('order-meta');
            const itemsEl = document.getElementById('order-items');
            const totalEl = document.getElementById('order-total');

            const created = order.createdAt ? new Date(order.createdAt).toLocaleString('th-TH') : '';
            metaEl.innerHTML = `<div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${created}</div><div>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${order.phone || '-'}</div>` + (order.address ? `<div>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:<br>${order.address.replace(/\n/g,'<br>')}</div>` : '');

            if(order.items && order.items.length){
                itemsEl.innerHTML = order.items.map(i=>{
                    const lineTotal = i.price * i.quantity;
                    return `<div class="item-row"><div>${i.name} ${i.size && i.size!=='N/A'? '('+i.size+')':''} √ó ${i.quantity}</div><div>${formatCurrency(lineTotal)}</div></div>`;
                }).join('');
            } else {
                itemsEl.innerHTML = '<div class="empty">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
            }

            totalEl.innerHTML = `<span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</span><span>${formatCurrency(order.total || 0)}</span>`;

            // Show payment method specific instructions
            if(order.paymentMethod){
                const pm = order.paymentMethod;
                const pmEl = document.createElement('div');
                pmEl.style.marginTop = '12px';
                if(pm === 'qr'){
                    pmEl.innerHTML = `<h3>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (QR)</h3>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ä‡∏≥‡∏£‡∏∞‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô Line/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</p>
                        <div style="text-align:center; margin-top:10px;"><img src="https://i.postimg.cc/26Bg9CCZ/af30c4e1-e184-4a32-bdeb-fb681e344b83.jpg" alt="QR" style="max-width:240px; width:60%; border:1px solid #eee; padding:8px; background:#fff;"/></div>`;
                } else if(pm === 'cod'){
                    pmEl.innerHTML = `<h3>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (COD)</h3>
                        <p>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° COD ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏™‡πà‡∏á)</p>`;
                } else {
                    pmEl.innerHTML = `<div>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ${pm}</div>`;
                }
                document.getElementById('receipt-content').appendChild(pmEl);
            }

            document.getElementById('print-btn').addEventListener('click', ()=>{ window.print(); });
            document.getElementById('home-btn').addEventListener('click', ()=>{ window.location.href = 'index.html'; });
        });
    </script>

    <!-- Chatbot -->
    <div id="chatbot-container" class="chatbot-container">
        <div class="chatbot-header">
            <h3>üí¨ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
            <button id="chatbot-close" class="chatbot-close">&times;</button>
        </div>
        <div id="chatbot-messages" class="chatbot-messages"></div>
        <div class="chatbot-input-area">
            <input type="text" id="chatbot-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
            <button id="chatbot-send">‡∏™‡πà‡∏á</button>
        </div>
    </div>

    <button id="chatbot-toggle" class="chatbot-toggle">üí¨</button>

    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="cart.js"></script>
    <script src="chatbot.js"></script>
</body>
</html>
